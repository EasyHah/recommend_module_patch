<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¯­éŸ³åŠ©æ‰‹ + AIèŠå¤©æœºå™¨äººé›†æˆæ¼”ç¤º</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 2rem;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }
        
        .header {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .header h1 {
            color: #333;
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .header p {
            color: #666;
            font-size: 1.1rem;
        }
        
        .demo-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }
        
        .demo-section {
            background: white;
            padding: 1.5rem;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(102, 126, 234, 0.1);
        }
        
        .demo-section h3 {
            color: #333;
            margin-bottom: 1rem;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .voice-control {
            text-align: center;
        }
        
        .voice-button {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
            margin-bottom: 1rem;
        }
        
        .voice-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }
        
        .voice-button.listening {
            animation: pulse 1.5s infinite;
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
        }
        
        .voice-button.processing {
            animation: spin 1s linear infinite;
            background: linear-gradient(45deg, #feca57, #ff9ff3);
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .status {
            padding: 0.8rem;
            border-radius: 10px;
            margin: 0.5rem 0;
            font-weight: 500;
        }
        
        .status.idle {
            background: #e8f4fd;
            color: #1e88e5;
            border-left: 4px solid #1e88e5;
        }
        
        .status.listening {
            background: #fff3e0;
            color: #f57c00;
            border-left: 4px solid #f57c00;
        }
        
        .status.processing {
            background: #fce4ec;
            color: #c2185b;
            border-left: 4px solid #c2185b;
        }
        
        .status.success {
            background: #e8f5e8;
            color: #2e7d32;
            border-left: 4px solid #2e7d32;
        }
        
        .status.error {
            background: #ffebee;
            color: #c62828;
            border-left: 4px solid #c62828;
        }
        
        .transcript-area {
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            padding: 1rem;
            border-radius: 10px;
            min-height: 100px;
            margin: 1rem 0;
            font-family: 'Courier New', monospace;
            color: #495057;
        }
        
        .chat-container {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 1rem;
            height: 300px;
            overflow-y: auto;
            border: 1px solid #dee2e6;
        }
        
        .integration-area {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            border-radius: 15px;
            margin-top: 2rem;
        }
        
        .integration-area h3 {
            color: white;
            margin-bottom: 1rem;
        }
        
        .integration-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .integration-option {
            background: rgba(255, 255, 255, 0.1);
            padding: 1rem;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .integration-option h4 {
            margin-bottom: 0.5rem;
            color: #fff;
        }
        
        .integration-option p {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
        }
        
        .control-panel {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }
        
        .control-btn {
            padding: 0.6rem 1.2rem;
            border: none;
            border-radius: 8px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }
        
        .control-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        .control-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .message {
            margin: 0.5rem 0;
            padding: 0.5rem;
            border-radius: 8px;
        }
        
        .message.user {
            background: #e3f2fd;
            text-align: right;
        }
        
        .message.ai {
            background: #f3e5f5;
            text-align: left;
        }
        
        .message.system {
            background: #fff3e0;
            text-align: center;
            font-style: italic;
            color: #f57c00;
        }
        
        .sdk-status {
            background: #fff;
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 1rem;
            border-left: 4px solid #667eea;
        }
        
        .sdk-status h4 {
            color: #333;
            margin-bottom: 0.5rem;
        }
        
        .logs {
            background: #1e1e1e;
            color: #00ff00;
            padding: 1rem;
            border-radius: 10px;
            height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
            margin-top: 1rem;
        }
        
        @media (max-width: 768px) {
            .demo-grid {
                grid-template-columns: 1fr;
            }
            
            .integration-options {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¤– æ™ºèƒ½è¯­éŸ³åŠ©æ‰‹ + AIèŠå¤©æœºå™¨äºº</h1>
            <p>æ¼”ç¤ºè¯­éŸ³è¯†åˆ«ä¸é˜¿é‡Œäº‘ Appflow Chat SDK çš„æ·±åº¦é›†æˆ</p>
        </div>
        
        <div class="sdk-status">
            <h4>ğŸ“Š SDK çŠ¶æ€æ£€æµ‹</h4>
            <div id="sdkStatus">â³ æ­£åœ¨æ£€æµ‹ Appflow Chat SDK...</div>
        </div>
        
        <div class="demo-grid">
            <!-- è¯­éŸ³æ§åˆ¶åŒºåŸŸ -->
            <div class="demo-section">
                <h3>ğŸ¤ è¯­éŸ³åŠ©æ‰‹æ§åˆ¶</h3>
                <div class="voice-control">
                    <button id="voiceButton" class="voice-button" title="ç‚¹å‡»å¼€å§‹è¯­éŸ³è¯†åˆ«">
                        ğŸ¤
                    </button>
                    <div id="voiceStatus" class="status idle">å‡†å¤‡å°±ç»ª - ç‚¹å‡»å¼€å§‹è¯­éŸ³è¯†åˆ«</div>
                    <div class="transcript-area" id="transcriptArea">
                        è¯­éŸ³è¯†åˆ«ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...
                    </div>
                    
                    <div class="control-panel">
                        <button class="control-btn" id="testVoiceBtn">ğŸ§ª æµ‹è¯•è¯­éŸ³</button>
                        <button class="control-btn" id="clearTranscriptBtn">ğŸ—‘ï¸ æ¸…ç©ºè®°å½•</button>
                        <button class="control-btn" id="helpBtn">â“ è¯­éŸ³å‘½ä»¤</button>
                    </div>
                </div>
            </div>
            
            <!-- AI èŠå¤©åŒºåŸŸ -->
            <div class="demo-section">
                <h3>ğŸ’¬ AI èŠå¤©æœºå™¨äºº</h3>
                <div class="chat-container" id="chatContainer">
                    <div class="message system">AI èŠå¤©æœºå™¨äººå·²å‡†å¤‡å°±ç»ª</div>
                </div>
                
                <div class="control-panel">
                    <button class="control-btn" id="showChatBtn">ğŸ‘ï¸ æ˜¾ç¤ºèŠå¤©çª—</button>
                    <button class="control-btn" id="hideChatBtn">ğŸ™ˆ éšè—èŠå¤©çª—</button>
                    <button class="control-btn" id="sendTestMsgBtn">ğŸ’¬ å‘é€æµ‹è¯•æ¶ˆæ¯</button>
                    <button class="control-btn" id="clearChatBtn">ğŸ—‘ï¸ æ¸…ç©ºèŠå¤©</button>
                </div>
            </div>
        </div>
        
        <!-- é›†æˆæ–¹æ¡ˆå±•ç¤º -->
        <div class="integration-area">
            <h3>ğŸ”— è¯­éŸ³ä¸AIèŠå¤©é›†æˆæ–¹æ¡ˆ</h3>
            <p>ä»¥ä¸‹æ˜¯å°†è¯­éŸ³åŠ©æ‰‹ä¸ Appflow Chat SDK ç»“åˆçš„å¤šç§é›†æˆæ¨¡å¼ï¼š</p>
            
            <div class="integration-options">
                <div class="integration-option">
                    <h4>ğŸ¯ ç›´æ¥ä¼ é€’æ¨¡å¼</h4>
                    <p>å°†è¯­éŸ³è¯†åˆ«ç»“æœç›´æ¥å‘é€ç»™AIèŠå¤©æœºå™¨äººï¼Œå®ç°è¯­éŸ³é—®ç­”åŠŸèƒ½</p>
                </div>
                
                <div class="integration-option">
                    <h4>ğŸ§  æ™ºèƒ½é¢„å¤„ç†æ¨¡å¼</h4>
                    <p>å¯¹è¯­éŸ³å†…å®¹è¿›è¡Œæ„å›¾è¯†åˆ«å’Œå®ä½“æŠ½å–ï¼Œç„¶åè°ƒç”¨ç›¸åº”çš„AIæœåŠ¡</p>
                </div>
                
                <div class="integration-option">
                    <h4>ğŸ® è¯­éŸ³æ§åˆ¶æ¨¡å¼</h4>
                    <p>ä½¿ç”¨è¯­éŸ³å‘½ä»¤æ§åˆ¶èŠå¤©çª—å£çš„æ˜¾ç¤º/éšè—ã€æ¸…ç©ºç­‰æ“ä½œ</p>
                </div>
                
                <div class="integration-option">
                    <h4>ğŸ“± å¤šæ¨¡æ€äº¤äº’æ¨¡å¼</h4>
                    <p>ç»“åˆè¯­éŸ³è¾“å…¥ã€æ–‡å­—è¾“å‡ºã€å›¾åƒç†è§£ç­‰å¤šç§äº¤äº’æ–¹å¼</p>
                </div>
            </div>
            
            <div class="control-panel">
                <button class="control-btn" id="enableIntegrationBtn">ğŸš€ å¯ç”¨é›†æˆæ¨¡å¼</button>
                <button class="control-btn" id="testIntegrationBtn">ğŸ§ª æµ‹è¯•é›†æˆåŠŸèƒ½</button>
                <button class="control-btn" id="exportConfigBtn">ğŸ“¥ å¯¼å‡ºé…ç½®</button>
            </div>
        </div>
        
        <div class="logs" id="logs">
            <div>[ç³»ç»Ÿ] æ—¥å¿—è®°å½•å·²å¯åŠ¨...</div>
        </div>
    </div>

    <!-- Appflow Chat SDK -->
    <script src="https://o.alicdn.com/appflow/chatbot/v1/AppflowChatSDK.js"></script>
    
    <script>
        // å…¨å±€çŠ¶æ€ç®¡ç†
        const AppState = {
            isSDKReady: false,
            isVoiceListening: false,
            isIntegrationEnabled: false,
            chatMessages: [],
            voiceCommands: [
                "æ˜¾ç¤ºèŠå¤©çª—å£",
                "éšè—èŠå¤©çª—å£", 
                "æ¸…ç©ºèŠå¤©è®°å½•",
                "å‘é€æ¶ˆæ¯ç»™AI",
                "å¼€å§‹è¯­éŸ³è¾“å…¥",
                "åœæ­¢è¯­éŸ³è¾“å…¥",
                "å¸®åŠ©æˆ‘",
                "é€€å‡ºç¨‹åº"
            ]
        };
        
        // DOM å…ƒç´ å¼•ç”¨
        const elements = {
            sdkStatus: document.getElementById('sdkStatus'),
            voiceButton: document.getElementById('voiceButton'),
            voiceStatus: document.getElementById('voiceStatus'),
            transcriptArea: document.getElementById('transcriptArea'),
            chatContainer: document.getElementById('chatContainer'),
            logs: document.getElementById('logs')
        };
        
        // æ—¥å¿—ç³»ç»Ÿ
        class Logger {
            static log(message, type = 'info') {
                const timestamp = new Date().toLocaleTimeString();
                const logEntry = `[${timestamp}] [${type.toUpperCase()}] ${message}`;
                console.log(logEntry);
                
                const logDiv = document.createElement('div');
                logDiv.textContent = logEntry;
                logDiv.style.color = type === 'error' ? '#ff6b6b' : 
                                   type === 'warn' ? '#feca57' : 
                                   type === 'success' ? '#00ff00' : '#ffffff';
                elements.logs.appendChild(logDiv);
                elements.logs.scrollTop = elements.logs.scrollHeight;
                
                // é™åˆ¶æ—¥å¿—æ¡æ•°
                if (elements.logs.children.length > 50) {
                    elements.logs.removeChild(elements.logs.firstChild);
                }
            }
        }
        
        // è¯­éŸ³è¯†åˆ«ç³»ç»Ÿ
        class VoiceRecognition {
            constructor() {
                this.recognition = null;
                this.isSupported = this.checkSupport();
                this.isListening = false;
                this.init();
            }
            
            checkSupport() {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                return !!SpeechRecognition;
            }
            
            init() {
                if (!this.isSupported) {
                    Logger.log('æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³è¯†åˆ«åŠŸèƒ½', 'error');
                    this.updateStatus('error', 'âŒ æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³è¯†åˆ«');
                    return;
                }
                
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                this.recognition = new SpeechRecognition();
                
                // é…ç½®è¯­éŸ³è¯†åˆ«
                this.recognition.continuous = true;
                this.recognition.interimResults = true;
                this.recognition.lang = 'zh-CN';
                this.recognition.maxAlternatives = 1;
                
                // ç»‘å®šäº‹ä»¶
                this.recognition.onstart = () => this.onStart();
                this.recognition.onresult = (event) => this.onResult(event);
                this.recognition.onerror = (event) => this.onError(event);
                this.recognition.onend = () => this.onEnd();
                
                Logger.log('è¯­éŸ³è¯†åˆ«ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ', 'success');
            }
            
            start() {
                if (!this.isSupported || this.isListening) return;
                
                try {
                    this.recognition.start();
                } catch (error) {
                    Logger.log(`å¯åŠ¨è¯­éŸ³è¯†åˆ«å¤±è´¥: ${error.message}`, 'error');
                }
            }
            
            stop() {
                if (!this.isSupported || !this.isListening) return;
                
                try {
                    this.recognition.stop();
                } catch (error) {
                    Logger.log(`åœæ­¢è¯­éŸ³è¯†åˆ«å¤±è´¥: ${error.message}`, 'error');
                }
            }
            
            onStart() {
                this.isListening = true;
                AppState.isVoiceListening = true;
                this.updateStatus('listening', 'ğŸ¤ æ­£åœ¨ç›‘å¬...');
                this.updateButton('listening');
                Logger.log('å¼€å§‹è¯­éŸ³è¯†åˆ«', 'info');
            }
            
            onResult(event) {
                let interimTranscript = '';
                let finalTranscript = '';
                
                for (let i = event.resultIndex; i < event.results.length; i++) {
                    const transcript = event.results[i][0].transcript;
                    
                    if (event.results[i].isFinal) {
                        finalTranscript += transcript;
                    } else {
                        interimTranscript += transcript;
                    }
                }
                
                // æ›´æ–°æ˜¾ç¤º
                elements.transcriptArea.innerHTML = `
                    <div style="color: #28a745;">${finalTranscript}</div>
                    <div style="color: #6c757d; font-style: italic;">${interimTranscript}</div>
                `;
                
                // å¤„ç†æœ€ç»ˆç»“æœ
                if (finalTranscript) {
                    Logger.log(`è¯­éŸ³è¯†åˆ«ç»“æœ: ${finalTranscript}`, 'success');
                    this.processVoiceCommand(finalTranscript);
                    
                    // å¦‚æœå¯ç”¨äº†é›†æˆæ¨¡å¼ï¼Œå°†è¯­éŸ³ç»“æœå‘é€ç»™AI
                    if (AppState.isIntegrationEnabled) {
                        AIIntegration.processVoiceInput(finalTranscript);
                    }
                }
            }
            
            onError(event) {
                Logger.log(`è¯­éŸ³è¯†åˆ«é”™è¯¯: ${event.error}`, 'error');
                this.updateStatus('error', `âŒ è¯†åˆ«é”™è¯¯: ${event.error}`);
                this.isListening = false;
                AppState.isVoiceListening = false;
                this.updateButton('idle');
            }
            
            onEnd() {
                this.isListening = false;
                AppState.isVoiceListening = false;
                this.updateStatus('idle', 'â¸ï¸ è¯†åˆ«å·²åœæ­¢');
                this.updateButton('idle');
                Logger.log('è¯­éŸ³è¯†åˆ«ç»“æŸ', 'info');
            }
            
            processVoiceCommand(command) {
                const cmd = command.toLowerCase().trim();
                
                // è¯­éŸ³å‘½ä»¤å¤„ç†
                if (cmd.includes('æ˜¾ç¤ºèŠå¤©') || cmd.includes('æ‰“å¼€èŠå¤©')) {
                    ChatManager.showChatWindow();
                } else if (cmd.includes('éšè—èŠå¤©') || cmd.includes('å…³é—­èŠå¤©')) {
                    ChatManager.hideChatWindow();
                } else if (cmd.includes('æ¸…ç©ºèŠå¤©')) {
                    ChatManager.clearChat();
                } else if (cmd.includes('å¸®åŠ©') || cmd.includes('å‘½ä»¤')) {
                    this.showVoiceCommands();
                } else if (cmd.includes('åœæ­¢') || cmd.includes('é€€å‡º')) {
                    this.stop();
                }
                
                // è®°å½•å‘½ä»¤
                ChatManager.addMessage('user', `ğŸ¤ ${command}`);
            }
            
            showVoiceCommands() {
                const commands = AppState.voiceCommands.join('\nâ€¢ ');
                alert(`å¯ç”¨çš„è¯­éŸ³å‘½ä»¤ï¼š\n\nâ€¢ ${commands}`);
            }
            
            updateStatus(type, message) {
                elements.voiceStatus.className = `status ${type}`;
                elements.voiceStatus.textContent = message;
            }
            
            updateButton(state) {
                elements.voiceButton.className = `voice-button ${state}`;
                
                if (state === 'listening') {
                    elements.voiceButton.textContent = 'â¹ï¸';
                    elements.voiceButton.title = 'ç‚¹å‡»åœæ­¢è¯­éŸ³è¯†åˆ«';
                } else if (state === 'processing') {
                    elements.voiceButton.textContent = 'âš¡';
                    elements.voiceButton.title = 'æ­£åœ¨å¤„ç†...';
                } else {
                    elements.voiceButton.textContent = 'ğŸ¤';
                    elements.voiceButton.title = 'ç‚¹å‡»å¼€å§‹è¯­éŸ³è¯†åˆ«';
                }
            }
        }
        
        // èŠå¤©ç®¡ç†ç³»ç»Ÿ
        class ChatManager {
            static addMessage(sender, content) {
                const message = document.createElement('div');
                message.className = `message ${sender}`;
                message.textContent = content;
                
                elements.chatContainer.appendChild(message);
                elements.chatContainer.scrollTop = elements.chatContainer.scrollHeight;
                
                AppState.chatMessages.push({ sender, content, timestamp: new Date() });
                Logger.log(`æ·»åŠ æ¶ˆæ¯ [${sender}]: ${content}`, 'info');
            }
            
            static showChatWindow() {
                if (window.APPFLOW_CHAT_SDK && window.APPFLOW_CHAT_SDK.show) {
                    window.APPFLOW_CHAT_SDK.show();
                    Logger.log('æ˜¾ç¤ºAIèŠå¤©çª—å£', 'info');
                    this.addMessage('system', 'ğŸ’¬ AIèŠå¤©çª—å£å·²æ˜¾ç¤º');
                } else {
                    Logger.log('æ— æ³•æ˜¾ç¤ºèŠå¤©çª—å£ï¼šSDKæœªå°±ç»ª', 'warn');
                    this.addMessage('system', 'âš ï¸ AIèŠå¤©çª—å£ä¸å¯ç”¨');
                }
            }
            
            static hideChatWindow() {
                if (window.APPFLOW_CHAT_SDK && window.APPFLOW_CHAT_SDK.hide) {
                    window.APPFLOW_CHAT_SDK.hide();
                    Logger.log('éšè—AIèŠå¤©çª—å£', 'info');
                    this.addMessage('system', 'ğŸ™ˆ AIèŠå¤©çª—å£å·²éšè—');
                } else {
                    Logger.log('æ— æ³•éšè—èŠå¤©çª—å£ï¼šSDKæœªå°±ç»ª', 'warn');
                }
            }
            
            static clearChat() {
                elements.chatContainer.innerHTML = '<div class="message system">èŠå¤©è®°å½•å·²æ¸…ç©º</div>';
                AppState.chatMessages = [];
                Logger.log('æ¸…ç©ºèŠå¤©è®°å½•', 'info');
            }
            
            static sendTestMessage() {
                const testMessages = [
                    "ä½ å¥½ï¼Œæˆ‘æ˜¯è¯­éŸ³åŠ©æ‰‹æµ‹è¯•æ¶ˆæ¯",
                    "è¯·é—®ä»Šå¤©å¤©æ°”å¦‚ä½•ï¼Ÿ",
                    "å¸®æˆ‘æŸ¥è¯¢ä¸€ä¸‹è·¯çº¿ä¿¡æ¯",
                    "è¯­éŸ³è¯†åˆ«åŠŸèƒ½æ­£åœ¨æµ‹è¯•ä¸­"
                ];
                
                const randomMessage = testMessages[Math.floor(Math.random() * testMessages.length)];
                
                if (window.APPFLOW_CHAT_SDK && window.APPFLOW_CHAT_SDK.sendMessage) {
                    window.APPFLOW_CHAT_SDK.sendMessage(randomMessage);
                    this.addMessage('user', randomMessage);
                    Logger.log(`å‘é€æµ‹è¯•æ¶ˆæ¯: ${randomMessage}`, 'info');
                } else {
                    Logger.log('æ— æ³•å‘é€æ¶ˆæ¯ï¼šSDKæœªå°±ç»ª', 'warn');
                    this.addMessage('system', 'âš ï¸ æ— æ³•å‘é€æ¶ˆæ¯ï¼ŒSDKæœªå°±ç»ª');
                }
            }
        }
        
        // AIé›†æˆç³»ç»Ÿ
        class AIIntegration {
            static processVoiceInput(voiceText) {
                Logger.log(`å¤„ç†è¯­éŸ³è¾“å…¥: ${voiceText}`, 'info');
                
                // è¯­éŸ³å†…å®¹é¢„å¤„ç†
                const processedText = this.preprocessVoice(voiceText);
                
                // å‘é€ç»™AIèŠå¤©æœºå™¨äºº
                if (window.APPFLOW_CHAT_SDK && window.APPFLOW_CHAT_SDK.sendMessage) {
                    window.APPFLOW_CHAT_SDK.sendMessage(processedText);
                    ChatManager.addMessage('user', `ğŸ§  ${processedText}`);
                    Logger.log('è¯­éŸ³å†…å®¹å·²å‘é€ç»™AI', 'success');
                } else {
                    Logger.log('AI SDKæœªå°±ç»ªï¼Œæ— æ³•å¤„ç†è¯­éŸ³è¾“å…¥', 'warn');
                }
            }
            
            static preprocessVoice(text) {
                // ç®€å•çš„æ–‡æœ¬é¢„å¤„ç†
                let processed = text.trim();
                
                // æ·»åŠ ç¤¼è²Œç”¨è¯­
                if (!processed.includes('è¯·') && !processed.includes('å¸®') && !processed.includes('è°¢è°¢')) {
                    processed = `è¯·å¸®æˆ‘${processed}`;
                }
                
                // ç¡®ä¿ä»¥é—®å·æˆ–å¥å·ç»“å°¾
                if (!processed.endsWith('ï¼Ÿ') && !processed.endsWith('?') && 
                    !processed.endsWith('ã€‚') && !processed.endsWith('.')) {
                    processed += 'ï¼Ÿ';
                }
                
                return processed;
            }
            
            static enableIntegration() {
                AppState.isIntegrationEnabled = true;
                Logger.log('å¯ç”¨è¯­éŸ³-AIé›†æˆæ¨¡å¼', 'success');
                ChatManager.addMessage('system', 'ğŸš€ é›†æˆæ¨¡å¼å·²å¯ç”¨');
            }
            
            static testIntegration() {
                const testVoiceInputs = [
                    "ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·",
                    "å¸®æˆ‘æŸ¥è¯¢é™„è¿‘çš„é¤å…",
                    "æˆ‘æƒ³äº†è§£ä¸€ä¸‹è·¯çº¿è§„åˆ’",
                    "è¯­éŸ³é›†æˆæµ‹è¯•ä¸­"
                ];
                
                const randomInput = testVoiceInputs[Math.floor(Math.random() * testVoiceInputs.length)];
                Logger.log(`æµ‹è¯•é›†æˆåŠŸèƒ½ï¼Œæ¨¡æ‹Ÿè¯­éŸ³è¾“å…¥: ${randomInput}`, 'info');
                
                // æ¨¡æ‹Ÿè¯­éŸ³è¯†åˆ«ç»“æœ
                elements.transcriptArea.innerHTML = `<div style="color: #28a745;">ğŸ§ª æµ‹è¯•: ${randomInput}</div>`;
                
                // å¤„ç†è¾“å…¥
                this.processVoiceInput(randomInput);
            }
        }
        
        // SDK æ£€æµ‹å’Œåˆå§‹åŒ–
        class SDKManager {
            static async checkSDK() {
                Logger.log('å¼€å§‹æ£€æµ‹ Appflow Chat SDK...', 'info');
                
                // ç­‰å¾…SDKåŠ è½½
                let attempts = 0;
                const maxAttempts = 10;
                
                const checkInterval = setInterval(() => {
                    attempts++;
                    
                    if (window.APPFLOW_CHAT_SDK) {
                        clearInterval(checkInterval);
                        this.initializeSDK();
                    } else if (attempts >= maxAttempts) {
                        clearInterval(checkInterval);
                        this.handleSDKFailure();
                    } else {
                        Logger.log(`ç­‰å¾…SDKåŠ è½½... (${attempts}/${maxAttempts})`, 'info');
                        elements.sdkStatus.textContent = `â³ ç­‰å¾…SDKåŠ è½½ (${attempts}/${maxAttempts})`;
                    }
                }, 1000);
            }
            
            static initializeSDK() {
                try {
                    Logger.log('SDKå·²åŠ è½½ï¼Œå¼€å§‹åˆå§‹åŒ–...', 'info');
                    
                    const config = {
                        integrateConfig: {
                            integrateId: 'cit-44fd57644e264fecabe0',
                            domain: {
                                requestDomain: 'https://1677039950952251.appflow.aliyunnest.com'
                            }
                        }
                    };
                    
                    window.APPFLOW_CHAT_SDK.init(config);
                    
                    AppState.isSDKReady = true;
                    elements.sdkStatus.innerHTML = `
                        <span style="color: #28a745;">âœ… SDKåˆå§‹åŒ–æˆåŠŸ</span><br>
                        <small>é›†æˆID: ${config.integrateConfig.integrateId}</small>
                    `;
                    
                    Logger.log('Appflow Chat SDK åˆå§‹åŒ–æˆåŠŸ', 'success');
                    
                    // ç›‘å¬SDKäº‹ä»¶
                    this.bindSDKEvents();
                    
                } catch (error) {
                    Logger.log(`SDKåˆå§‹åŒ–å¤±è´¥: ${error.message}`, 'error');
                    this.handleSDKFailure();
                }
            }
            
            static handleSDKFailure() {
                elements.sdkStatus.innerHTML = `
                    <span style="color: #dc3545;">âŒ SDKåˆå§‹åŒ–å¤±è´¥</span><br>
                    <small>è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œé…ç½®</small>
                `;
                Logger.log('SDKåˆå§‹åŒ–å¤±è´¥ï¼ŒæŸäº›åŠŸèƒ½å¯èƒ½ä¸å¯ç”¨', 'error');
            }
            
            static bindSDKEvents() {
                // ç›‘å¬å¯èƒ½çš„SDKäº‹ä»¶
                window.addEventListener('appflowChatReady', (event) => {
                    Logger.log('AIèŠå¤©æœºå™¨äººå·²å‡†å¤‡å°±ç»ª', 'success');
                    ChatManager.addMessage('system', 'ğŸ¤– AIèŠå¤©æœºå™¨äººå·²ä¸Šçº¿');
                });
                
                window.addEventListener('appflowChatMessage', (event) => {
                    Logger.log(`æ”¶åˆ°AIå›å¤: ${event.detail}`, 'info');
                    ChatManager.addMessage('ai', `ğŸ¤– ${event.detail}`);
                });
                
                window.addEventListener('appflowChatError', (event) => {
                    Logger.log(`AIèŠå¤©é”™è¯¯: ${event.detail}`, 'error');
                    ChatManager.addMessage('system', `âŒ AIé”™è¯¯: ${event.detail}`);
                });
            }
        }
        
        // åˆå§‹åŒ–ç³»ç»Ÿ
        async function initializeApp() {
            Logger.log('å¼€å§‹åˆå§‹åŒ–åº”ç”¨ç¨‹åº...', 'info');
            
            // æ£€æµ‹å’Œåˆå§‹åŒ–SDK
            await SDKManager.checkSDK();
            
            // åˆå§‹åŒ–è¯­éŸ³è¯†åˆ«
            const voiceRecognition = new VoiceRecognition();
            
            // ç»‘å®šäº‹ä»¶ç›‘å¬å™¨
            bindEventListeners(voiceRecognition);
            
            Logger.log('åº”ç”¨ç¨‹åºåˆå§‹åŒ–å®Œæˆ', 'success');
        }
        
        // ç»‘å®šäº‹ä»¶ç›‘å¬å™¨
        function bindEventListeners(voiceRecognition) {
            // è¯­éŸ³æŒ‰é’®
            elements.voiceButton.addEventListener('click', () => {
                if (voiceRecognition.isListening) {
                    voiceRecognition.stop();
                } else {
                    voiceRecognition.start();
                }
            });
            
            // æ§åˆ¶æŒ‰é’®
            document.getElementById('testVoiceBtn').addEventListener('click', () => {
                voiceRecognition.processVoiceCommand('è¿™æ˜¯ä¸€ä¸ªè¯­éŸ³æµ‹è¯•æ¶ˆæ¯');
            });
            
            document.getElementById('clearTranscriptBtn').addEventListener('click', () => {
                elements.transcriptArea.textContent = 'è¯­éŸ³è¯†åˆ«ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...';
            });
            
            document.getElementById('helpBtn').addEventListener('click', () => {
                voiceRecognition.showVoiceCommands();
            });
            
            document.getElementById('showChatBtn').addEventListener('click', () => {
                ChatManager.showChatWindow();
            });
            
            document.getElementById('hideChatBtn').addEventListener('click', () => {
                ChatManager.hideChatWindow();
            });
            
            document.getElementById('sendTestMsgBtn').addEventListener('click', () => {
                ChatManager.sendTestMessage();
            });
            
            document.getElementById('clearChatBtn').addEventListener('click', () => {
                ChatManager.clearChat();
            });
            
            document.getElementById('enableIntegrationBtn').addEventListener('click', () => {
                AIIntegration.enableIntegration();
            });
            
            document.getElementById('testIntegrationBtn').addEventListener('click', () => {
                AIIntegration.testIntegration();
            });
            
            document.getElementById('exportConfigBtn').addEventListener('click', () => {
                const config = {
                    appState: AppState,
                    timestamp: new Date().toISOString(),
                    integration: {
                        sdkReady: AppState.isSDKReady,
                        voiceSupported: voiceRecognition.isSupported,
                        integrationEnabled: AppState.isIntegrationEnabled
                    }
                };
                
                const blob = new Blob([JSON.stringify(config, null, 2)], {
                    type: 'application/json'
                });
                
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'voice-ai-integration-config.json';
                a.click();
                URL.revokeObjectURL(url);
                
                Logger.log('é…ç½®æ–‡ä»¶å·²å¯¼å‡º', 'success');
            });
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåå¯åŠ¨åº”ç”¨
        window.addEventListener('load', initializeApp);
        
        // é”™è¯¯å¤„ç†
        window.addEventListener('error', (event) => {
            Logger.log(`å…¨å±€é”™è¯¯: ${event.message}`, 'error');
        });
        
        // åœ¨é¡µé¢å¸è½½å‰æ¸…ç†
        window.addEventListener('beforeunload', () => {
            Logger.log('åº”ç”¨ç¨‹åºæ­£åœ¨å…³é—­...', 'info');
        });
    </script>
</body>
</html>